{"version":3,"sources":["components/polyline.jsx","components/utils.jsx","components/Map.jsx","components/Header.jsx","components/Panel.jsx","App.jsx","index.jsx","components/constants.jsx"],"names":["DECODING_TABLE","Num","Number","toSigned","val","res","toString","decode","encoded","decoder","result","shift","resList","split","forEach","char","value","charCode","charCodeAt","decodeChar","push","Error","decodeUnsignedValues","header","version","encodedHeader","headerNumber","precision","thirdDim","thirdDimPrecision","decodeHeader","factorDegree","factorZ","lastLat","lastLng","lastZ","i","length","polyline","getClinics","a","axios","get","clinics","then","resp","data","catch","e","console","log","gjson","getIso","geom","iso_api","HERE","isolineToJson","isolines","polygons","outer","iso","coords","reverse","polygon","getStatistics","sa2","LINZ","iso2193","transformCoords","wkt","stringify","cql","post","querystring","cql_filter","headers","intersect","calcStatistics","features","total","properties","C18_OccPrivDwelDamp_Total","none","C18_OccPrivDwelDamp_Not_Damp","damp_some","C18_OccPrivDwelDamp_Sometimes","damp_always","C18_OccPrivDwelDamp_Always","hex_percent","hex_colour","percent","calcHex","min","max","c","breaks","transformBbox","srid","bbox","b","x_3857","proj4","y_3857","x_4167","y_4167","x_2193","y_2193","geometry","coordinates","defs","Map","props","sendToParent","selection","callback","addLayers","that","map","state","bbox2193","getBounds","toArray","addSource","addLayer","loadImage","err","gp","addImage","addLyrListControls","on","getCanvas","style","cursor","pop","mapboxgl","Popup","closeOnClick","offset","description","Name","Address","DHB_Name","PHO","setLngLat","lngLat","setHTML","addTo","activity","isojson","addIsoLayer","lyrcoords","fitBounds","padding","results","addStatisticsLayer","updateLayers","getSource","lyr","setData","getLayer","removeLayer","removeSource","moveLayer","hoverPop","closeButton","toFixed","remove","toggleableLayerIds","id","label","legend","legendVal","link","document","createElement","vis","getLayoutProperty","href","className","innerHTML","onclick","clickedLayer","this","preventDefault","stopPropagation","setLayoutProperty","getElementById","appendChild","addCustomControls","geocoder","MapboxGeocoder","accessToken","countries","placeholder","nav","NavigationControl","scale","ScaleControl","maxWidth","unit","addControl","bool","setState","fly","loc","flyTo","center","zoom","mapRef","React","createRef","popup","vw","container","Spinner","variant","animation","Nav","Item","Link","onClick","Component","Header","Navbar","bg","expand","sticky","Toggle","aria-controls","Collapse","PanelLeft","modal","d","resetView","window","location","reload","showModal","hideModal","src","alt","width","rel","target","App","isLoading","callbackSelection","Container","fluid","Row","Col","xs","md","Panel","ReactDOM","render","StrictMode","module","exports","H_DATA_ID","H_DATA"],"mappings":"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","file":"static/js/main.9ae6ba63.chunk.js","sourcesContent":["/*\n * Copyright (C) 2019 HERE Europe B.V.\n * Licensed under MIT, see full license in LICENSE\n * SPDX-License-Identifier: MIT\n * License-Filename: LICENSE\n */\nconst DEFAULT_PRECISION = 5;\n\nconst ENCODING_TABLE = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_\";\n\nconst DECODING_TABLE = [\n    62, -1, -1, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1, -1, -1, -1, -1, -1,\n    0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19, 20, 21,\n    22, 23, 24, 25, -1, -1, -1, -1, 63, -1, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35,\n    36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48, 49, 50, 51\n];\n\nconst FORMAT_VERSION = 1;\n\nconst ABSENT = 0;\nconst LEVEL = 1;\nconst ALTITUDE = 2;\nconst ELEVATION = 3;\n// Reserved values 4 and 5 should not be selectable\nconst CUSTOM1 = 6;\nconst CUSTOM2 = 7;\n\nconst Num = Number;\n\nfunction decode(encoded) {\n    const decoder = decodeUnsignedValues(encoded);\n    const header = decodeHeader(decoder[0], decoder[1]);\n\n    const factorDegree = 10 ** header.precision;\n    const factorZ = 10 ** header.thirdDimPrecision;\n    const { thirdDim } = header;\n\n    let lastLat = 0;\n    let lastLng = 0;\n    let lastZ = 0;\n    const res = [];\n\n    let i = 2;\n    for (;i < decoder.length;) {\n        const deltaLat = toSigned(decoder[i]) / factorDegree;\n        const deltaLng = toSigned(decoder[i + 1]) / factorDegree;\n        lastLat += deltaLat;\n        lastLng += deltaLng;\n\n        if (thirdDim) {\n            const deltaZ = toSigned(decoder[i + 2]) / factorZ;\n            lastZ += deltaZ;\n            res.push([lastLat, lastLng, lastZ]);\n            i += 3;\n        } else {\n            res.push([lastLat, lastLng]);\n            i += 2;\n        }\n    }\n\n    if (i !== decoder.length) {\n        throw new Error('Invalid encoding. Premature ending reached');\n    }\n\n    return {\n        ...header,\n        polyline: res,\n    };\n}\n\nfunction decodeChar(char) {\n    const charCode = char.charCodeAt(0);\n    return DECODING_TABLE[charCode - 45];\n}\n\nfunction decodeUnsignedValues(encoded) {\n    let result = Num(0);\n    let shift = Num(0);\n    const resList = [];\n\n    encoded.split('').forEach((char) => {\n        const value = Num(decodeChar(char));\n        result |= (value & Num(0x1F)) << shift;\n        if ((value & Num(0x20)) === Num(0)) {\n            resList.push(result);\n            result = Num(0);\n            shift = Num(0);\n        } else {\n            shift += Num(5);\n        }\n    });\n\n    if (shift > 0) {\n        throw new Error('Invalid encoding');\n    }\n\n    return resList;\n}\n\nfunction decodeHeader(version, encodedHeader) {\n    if (+version.toString() !== FORMAT_VERSION) {\n        throw new Error('Invalid format version');\n    }\n    const headerNumber = +encodedHeader.toString();\n    const precision = headerNumber & 15;\n    const thirdDim = (headerNumber >> 4) & 7;\n    const thirdDimPrecision = (headerNumber >> 7) & 15;\n    return { precision, thirdDim, thirdDimPrecision };\n}\n\nfunction toSigned(val) {\n    // Decode the sign from an unsigned value\n    let res = val;\n    if (res & Num(1)) {\n        res = ~res;\n    }\n    res >>= Num(1);\n    return +res.toString();\n}\n\nfunction encode({ precision = DEFAULT_PRECISION, thirdDim = ABSENT, thirdDimPrecision = 0, polyline }) {\n    // Encode a sequence of lat,lng or lat,lng(,{third_dim}). Note that values should be of type BigNumber\n    //   `precision`: how many decimal digits of precision to store the latitude and longitude.\n    //   `third_dim`: type of the third dimension if present in the input.\n    //   `third_dim_precision`: how many decimal digits of precision to store the third dimension.\n\n    const multiplierDegree = 10 ** precision;\n    const multiplierZ = 10 ** thirdDimPrecision;\n    const encodedHeaderList = encodeHeader(precision, thirdDim, thirdDimPrecision);\n    const encodedCoords = [];\n\n    let lastLat = Num(0);\n    let lastLng = Num(0);\n    let lastZ = Num(0);\n    polyline.forEach((location) => {\n       const lat = Num(Math.round(location[0] * multiplierDegree));\n       encodedCoords.push(encodeScaledValue(lat - lastLat));\n       lastLat = lat;\n\n       const lng = Num(Math.round(location[1] * multiplierDegree));\n       encodedCoords.push(encodeScaledValue(lng - lastLng));\n       lastLng = lng;\n\n       if (thirdDim) {\n           const z = Num(Math.round(location[2] * multiplierZ));\n           encodedCoords.push(encodeScaledValue(z - lastZ));\n           lastZ = z;\n       }\n    });\n\n    return [...encodedHeaderList, ...encodedCoords].join('');\n}\n\nfunction encodeHeader(precision, thirdDim, thirdDimPrecision) {\n    // Encode the `precision`, `third_dim` and `third_dim_precision` into one encoded char\n    if (precision < 0 || precision > 15) {\n        throw new Error('precision out of range. Should be between 0 and 15');\n    }\n    if (thirdDimPrecision < 0 || thirdDimPrecision > 15) {\n        throw new Error('thirdDimPrecision out of range. Should be between 0 and 15');\n    }\n    if (thirdDim < 0 || thirdDim > 7 || thirdDim === 4 || thirdDim === 5) {\n        throw new Error('thirdDim should be between 0, 1, 2, 3, 6 or 7');\n    }\n\n    const res = (thirdDimPrecision << 7) | (thirdDim << 4) | precision;\n    return encodeUnsignedNumber(FORMAT_VERSION) + encodeUnsignedNumber(res);\n}\n\nfunction encodeUnsignedNumber(val) {\n    // Uses variable integer encoding to encode an unsigned integer. Returns the encoded string.\n    let res = '';\n    let numVal = Num(val);\n    while (numVal > 0x1F) {\n        const pos = (numVal & Num(0x1F)) | Num(0x20);\n        res += ENCODING_TABLE[pos];\n        numVal >>= Num(5);\n    }\n    return res + ENCODING_TABLE[numVal];\n}\n\nfunction encodeScaledValue(value) {\n    // Transform a integer `value` into a variable length sequence of characters.\n    //   `appender` is a callable where the produced chars will land to\n    let numVal = Num(value);\n    const negative = numVal < 0;\n    numVal <<= Num(1);\n    if (negative) {\n        numVal = ~numVal;\n    }\n\n    return encodeUnsignedNumber(numVal);\n}\n\n// module.exports = {\n//     encode,\n//     decode,\n\n//     ABSENT,\n//     LEVEL,\n//     ALTITUDE,\n//     ELEVATION,\n// };\n\nexport default decode;","import decode from './polyline';\nimport axios from 'axios';\nimport proj4 from 'proj4';\nimport querystring from 'querystring';\nimport { parse, stringify } from 'wellknown';\nimport { point, feature, featureCollection, \n  polygon, booleanOverlap } from '@turf/turf';\nimport { HERE, H_DATA_ID, H_DATA, LINZ } from './constants';\n\n// Proj4 defs for projection transformation\nproj4.defs(\"EPSG:2193\", \"+proj=tmerc +lat_0=0 +lon_0=173 +k=0.9996 +x_0=1600000 +y_0=10000000 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs\");\nproj4.defs(\"EPSG:4167\", \"+proj=longlat +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +no_defs\");\n\n// Utils\nexport async function getClinics () {\n  const clinics = 'https://services2.arcgis.com/9V7Qc4NIcvZBm0io/ArcGIS/rest/services/New_Zealand_Enrolled_General_Practitioner_Facilities/FeatureServer/0'\n  const qry = '/query?where=1%3D1&outFields=*&returnGeometry=true&resultRecordCount=5000&f=pgeojson'\n  let gjson = await axios.get(clinics+qry)\n    .then(resp => {\n      // console.log(resp)\n      let geojson = resp.data;\n      return geojson;\n    })\n    .catch(e => {\n      console.log(e)\n    })\n  return gjson;\n}\n\nexport async function getHERE () {\n  // Add geojson from HERE Studio\n  const ID = H_DATA_ID\n  const token = H_DATA\n  const admin_bdy = `https://xyz.api.here.com/hub/spaces/${ID}/search?access_token=${token}`\n\n  let data = await axios.get(admin_bdy)\n    .then(resp => {\n      console.log(resp)\n      var gjson = resp.data;\n      return gjson;\n    })\n    .catch(e => {\n      console.log(e)\n    })\n  return data;\n}\n\nexport async function getIso (geom) {\n  var iso_api = \n    `https://isoline.router.hereapi.com/v8/isolines?apiKey=${HERE}&transportMode=car&origin=${geom['lat']},${geom['lng']}&range[type]=distance&range[values]=3000&routingMode=fast`\n\n  let iso = await axios.get(iso_api)\n    .then(resp => {\n      var outer = decode(resp.data.isolines[0].polygons[0].outer)\n      var gjson = isolineToJson(outer)\n      return gjson;\n    })\n    .catch(e => {\n      console.log(e)\n    })\n  return iso;\n}\n\nexport function isolineToJson (iso) {\n  const coords = [];\n  for (let i = 0; i < iso.polyline.length; i++) {\n    coords.push(iso.polyline[i].reverse());\n  }\n  coords.push(iso.polyline[0])\n  const poly = polygon([coords]);\n  return poly;\n}\n\nexport async function getStatistics (iso) {\n  // WFS CQL Filtering for on the fly intersection\n  var fields = 'SHAPE,SA12018_V1_00,C18_OccPrivDwelDamp_Always,C18_OccPrivDwelDamp_Sometimes,C18_OccPrivDwelDamp_TotalWith,C18_OccPrivDwelDamp_Not_Damp,C18_OccPrivDwelDamp_TStated,C18_OccPrivDwelDamp_NEI,C18_OccPrivDwelDamp_Total,C18_OccPrivDwelMould_Always,C18_OccPrivDwelMould_Sometimes,C18_OccPrivDwelMould_TotalWith,C18_OccPrivDwelMould_No_mould,C18_OccPrivDwelMould_TStated,C18_OccPrivDwelMould_NEI,C18_OccPrivDwelMould_Total'\n  const sa2 = `https://datafinder.stats.govt.nz/services;key=${LINZ}/wfs?service=WFS&version=2.0.0&request=GetFeature&typeNames=layer-104628&SRSName=EPSG:4326&PropertyName=${fields}&outputformat=json`\n\n  let iso2193 = transformCoords(2193, iso)\n  var wkt = stringify(iso2193)\n  var cql = `Intersects(SHAPE,${wkt})`\n\n  let intersect = await axios.post(sa2, \n    querystring.stringify({\n      cql_filter: cql,\n    }), {\n      headers: { \n        \"Content-Type\": \"application/x-www-form-urlencoded\"\n      }\n    })\n    .then(resp => {\n      // console.log('used cql filter',resp.data)\n      let geojson = resp.data;\n      return geojson;\n    })\n    .catch(e => {\n      console.log(e)\n    })\n  return calcStatistics(intersect);\n}\n\nexport function calcStatistics (data) {\n  // Populate hex value according to dampness/mould rating\n  for (let i = 0; i < data.features.length; i++) {\n    // Assign values\n    var total = data.features[i].properties.C18_OccPrivDwelDamp_Total;\n    var none = data.features[i].properties.C18_OccPrivDwelDamp_Not_Damp;\n    var damp_some = data.features[i].properties.C18_OccPrivDwelDamp_Sometimes;\n    var damp_always = data.features[i].properties.C18_OccPrivDwelDamp_Always;\n\n    // Account for -999 anonymised data\n    if (total === 0 || none === -999) {\n      data.features[i].properties.hex_percent = 0;\n      data.features[i].properties.hex_colour = '#fff';\n    }\n    else {\n      // Calculate the percentage\n      var dampness = damp_some + damp_always;\n      var percent = (dampness / total) * 100;\n\n      data.features[i].properties.hex_percent = percent;\n      data.features[i].properties.hex_colour = calcHex(percent,0,70);\n    }\n  }\n  return data;\n}\n\nexport function calcHex (value, min, max) {\n  // CartoColor\n  //#008080,#70a494,#b4c8a8,#f6edbd,#edbb8a,#de8a5a,#ca562c\n  var c = ['#008080','#70a494','#b4c8a8','#f6edbd','#edbb8a','#de8a5a','#ca562c']\n  var breaks = (max - min) / 5;\n  if (min < 1) min = 1; \n  return value >= max ? c[6] :\n    value > min + (4 * breaks) ? c[5] :\n    value > min + (3 * breaks) ? c[4] :\n    value > min + (2 * breaks) ? c[3] :\n    value > min + (1 * breaks) ? c[2] :\n    value >= min ? c[1] : c[0];\n}\n\nexport function transformBbox (srid, bbox) {\n  // Get the bounds from map, or optional input bbox\n  // Returns a transformed and formatted bbox string\n  var srid = srid || 4326; \n  var b = bbox;\n  // 4326 = WGS84 (default)\n  if (srid === 4326) {\n      return `${b[0][0]},${b[0][1]},${b[1][0]},${b[1][1]}`\n  }\n  // 3857 = Web/Pseudo Mercator\n  else if (srid === 3857) {\n      var x_3857 = proj4(\"EPSG:4326\", \"EPSG:3857\", b[0])\n      var y_3857 = proj4(\"EPSG:4326\", \"EPSG:3857\", b[1])\n      return `${x_3857[1]},${x_3857[0]},${y_3857[1]},${y_3857[0]}`\n  }\n  // 4167 = NZGD2000 / Geographic\n  else if (srid === 4167) {\n      var x_4167 = proj4(\"EPSG:4326\", \"EPSG:4167\", b[0])\n      var y_4167 = proj4(\"EPSG:4326\", \"EPSG:4167\", b[1])\n      return `${x_4167[1]},${x_4167[0]},${y_4167[1]},${y_4167[0]}`\n  }\n  // 2193 = NZGD2000 / NZTM\n  else if (srid === 2193) {\n      var x_2193 = proj4(\"EPSG:4326\", \"EPSG:2193\", b[0])\n      var y_2193 = proj4(\"EPSG:4326\", \"EPSG:2193\", b[1])\n      return `${x_2193[1]},${x_2193[0]},${y_2193[1]},${y_2193[0]}`\n  }\n}\n\nexport function transformCoords (srid, gjson) {\n  // Transform from 4326 to local projected coordinate system\n  if (srid === 4326) {\n    return gjson;\n  }\n  // 2193 = NZGD2000 / NZTM\n  else if (srid === 2193) {\n    for (let i = 0; i < gjson.geometry.coordinates[0].length; i++) {\n      gjson.geometry.coordinates[0][i] = proj4(\"EPSG:4326\", \"EPSG:2193\", gjson.geometry.coordinates[0][i]).reverse()\n    }\n    // console.log('proj4',gjson)\n    return gjson;\n  }\n}","import React from 'react';\nimport { Nav, Spinner } from 'react-bootstrap';\nimport mapboxgl from 'mapbox-gl';\nimport { bbox } from '@turf/turf';\nimport { getClinics, getIso, getStatistics, transformBbox } from './utils';\nimport MapboxGeocoder from '@mapbox/mapbox-gl-geocoder';\nimport { LINZ } from './constants';\n\nclass Map extends React.Component {\n  constructor(props) {\n    super(props);\n    this.mapRef = React.createRef();\n    this.state = {\n      map: null,\n      selection: [],\n      popup: null,\n      activity: true\n    }\n  }\n\n  sendToParent = (selection) => {\n    this.props.callback(selection);\n  }  \n\n  addLayers = async () => {\n    const that = this;\n    const map = this.state.map;\n  \n    ////////////////////////////////////////\n    // SA2s\n    var bbox2193 = transformBbox(2193, map.getBounds().toArray())\n    var fields = 'SHAPE,SA12018_V1_00,C18_OccPrivDwelDamp_Always,C18_OccPrivDwelDamp_Sometimes,C18_OccPrivDwelDamp_TotalWith,C18_OccPrivDwelDamp_Not_Damp,C18_OccPrivDwelDamp_TStated,C18_OccPrivDwelDamp_NEI,C18_OccPrivDwelDamp_Total,C18_OccPrivDwelMould_Always,C18_OccPrivDwelMould_Sometimes,C18_OccPrivDwelMould_TotalWith,C18_OccPrivDwelMould_No_mould,C18_OccPrivDwelMould_TStated,C18_OccPrivDwelMould_NEI,C18_OccPrivDwelMould_Total'\n    var sa2 = `https://datafinder.stats.govt.nz/services;key=${LINZ}/wfs?service=WFS&version=2.0.0&request=GetFeature&typeNames=layer-104628&SRSName=EPSG:4326&BBOX=${bbox2193}&PropertyName=${fields}&outputformat=json`\n    map.addSource(\"sa2-src\", {\n      \"type\": \"geojson\",\n      \"data\": sa2\n    });\n    map.addLayer({\n        \"id\": \"sa2-lyr\",\n        \"type\": \"line\",\n        \"source\": \"sa2-src\",\n        'minzoom': 12,\n        'maxzoom': 22,\n        \"paint\": {\n            \"line-color\": \"#ddd\",\n            \"line-width\": 1\n        }\n    });\n    map.addLayer({\n        \"id\": \"sa2-lyr-fill\",\n        \"type\": \"fill\",\n        \"source\": \"sa2-src\",\n        'minzoom': 12,\n        'maxzoom': 22,\n        \"paint\": {\n            \"fill-outline-color\": \"#ddd\",\n            \"fill-color\": \"#ddd\",\n            \"fill-opacity\": 0.05,\n        }\n    });\n\n    ////////////////////////////////////////\n    // Clinics\n    var clinics = await getClinics()\n    // console.log('geojson is',clinics)\n    var img = './assets/svgs/hospital-15.svg.png'\n    map.loadImage(img, function(err,gp) {\n      if (err) throw err;\n      map.addImage('gp', gp)\n    });\n    map.addSource(\"clinics-src\", {\n      \"type\": \"geojson\",\n      \"data\": clinics\n    });\n    map.addLayer({\n      \"id\": \"clinics-lyr\",\n      \"type\": \"symbol\",\n      \"source\": \"clinics-src\",\n      'minzoom': 8,\n      'maxzoom': 22,\n      'layout': {\n        'icon-image': 'gp',\n        'icon-size': 1.05,\n        'icon-allow-overlap': true,\n      },\n    });\n    this.addLyrListControls();\n\n    // Change to a pointer\n    map.on('mouseenter', 'clinics-lyr', () => {\n      map.getCanvas().style.cursor = 'pointer';\n    });\n    // Change it back to a pointer when it leaves.\n    map.on('mouseleave', 'clinics-lyr', () => {\n      map.getCanvas().style.cursor = '';\n    });\n    // Create a popup, but don't add it to the map yet.\n    var pop = new mapboxgl.Popup({\n      // closeButton: false,\n      closeOnClick: false,\n      offset: 6\n    });\n    map.on('click', 'clinics-lyr', async function (e) {\n      // Change the cursor style as a UI indicator.\n      map.getCanvas().style.cursor = 'pointer';\n\n      var description = \n        \"<h6>GP / Health Clinic</h6>\" +\n        \"<strong>Name:</strong> \" + e.features[0].properties.Name + \"<br/>\" +\n        \"<strong>Address:</strong> \" + e.features[0].properties.Address + \",<br/>\" +\n        \"<strong>DHB:</strong> \" + e.features[0].properties.DHB_Name + \"<br/>\" +\n        \"<strong>PHO:</strong> \" + e.features[0].properties.PHO;\n\n      // Populate the popup and set its coordinates\n      // based on the feature found.\n      pop\n        .setLngLat(e.lngLat)\n        .setHTML(description)\n        .addTo(map);\n\n      // console.log('clicked',e.lngLat,e.features[0])\n\n      // Add isochrone layer\n      that.activity(true);\n      var isojson = await getIso(e.lngLat);\n      // console.log('isojson',isojson)\n      that.addIsoLayer(isojson);\n\n      // Fit map to the isochrone/service area layer\n      var lyrcoords = bbox(isojson)\n      map.fitBounds(lyrcoords, {\n        padding: 150\n      })\n\n      // Run intersection and analyse the results \n      var results = await getStatistics(isojson);\n      that.addStatisticsLayer(results);\n\n    });\n\n    this.activity(false);\n  }\n\n  updateLayers = () => {\n    // Handle bbox changes\n    var map = this.state.map;\n    var fields = 'SHAPE,SA12018_V1_00,C18_OccPrivDwelDamp_Always,C18_OccPrivDwelDamp_Sometimes,C18_OccPrivDwelDamp_TotalWith,C18_OccPrivDwelDamp_Not_Damp,C18_OccPrivDwelDamp_TStated,C18_OccPrivDwelDamp_NEI,C18_OccPrivDwelDamp_Total,C18_OccPrivDwelMould_Always,C18_OccPrivDwelMould_Sometimes,C18_OccPrivDwelMould_TotalWith,C18_OccPrivDwelMould_No_mould,C18_OccPrivDwelMould_TStated,C18_OccPrivDwelMould_NEI,C18_OccPrivDwelMould_Total'\n    var bbox2193 = transformBbox(2193, map.getBounds().toArray())\n      if (map.getSource(\"sa2-src\")) {\n        var lyr = map.getSource(\"sa2-src\");\n        var sa2 = `https://datafinder.stats.govt.nz/services;key=${LINZ}/wfs?service=WFS&version=2.0.0&request=GetFeature&typeNames=layer-104628&SRSName=EPSG:4326&BBOX=${bbox2193}&PropertyName=${fields}&outputformat=json`;\n        lyr.setData(sa2);\n      }\n  }\n\n  addIsoLayer = (iso) => {\n    // Add isoline layer on user selection\n    const map = this.state.map;\n    if (map.getLayer(\"iso-lyr\")) map.removeLayer(\"iso-lyr\");\n    if (map.getLayer(\"iso-lyr-fill\")) map.removeLayer(\"iso-lyr-fill\");\n    if (map.getSource(\"iso-src\")) map.removeSource(\"iso-src\");\n\n    map.addSource(\"iso-src\", {\n      \"type\": \"geojson\",\n      \"data\": iso\n    });\n    map.addLayer({\n      \"id\": \"iso-lyr\",\n      \"type\": \"line\",\n      \"source\": \"iso-src\",\n      'minzoom': 2,\n      'maxzoom': 22,\n      \"paint\": {\n          \"line-color\": \"#000\",\n          \"line-width\": 2\n      }\n    });\n\n    // Change to a pointer\n    map.on('mouseenter', 'iso-lyr', () => {\n      map.getCanvas().style.cursor = 'pointer';\n    });\n    // Change it back to a pointer when it leaves.\n    map.on('mouseleave', 'iso-lyr', () => {\n      map.getCanvas().style.cursor = '';\n    });\n    map.moveLayer('clinics-lyr')\n    this.activity(false);\n\n  }\n\n  addStatisticsLayer = (results) => {\n    // Add results layer and respective data viz\n    this.activity(true);\n    const map = this.state.map;\n    if (map.getLayer(\"results-lyr\")) map.removeLayer(\"results-lyr\");\n    if (map.getLayer(\"results-lyr-fill\")) map.removeLayer(\"results-lyr-fill\");\n    if (map.getSource(\"results-src\")) map.removeSource(\"results-src\");\n\n    map.addSource(\"results-src\", {\n      \"type\": \"geojson\",\n      \"data\": results\n    });\n    map.addLayer({\n      \"id\": \"results-lyr\",\n      \"type\": \"line\",\n      \"source\": \"results-src\",\n      'minzoom': 2,\n      'maxzoom': 22,\n      \"paint\": {\n          \"line-color\": \"#000\",\n          \"line-width\": 1\n      },\n    });\n    map.addLayer({\n      \"id\": \"results-lyr-fill\",\n      \"type\": \"fill\",\n      \"source\": \"results-src\",\n      'minzoom': 2,\n      'maxzoom': 22,\n      \"paint\": {\n        \"fill-color\": ['get','hex_colour'],\n        \"fill-opacity\": 0.85,\n      }\n    });\n\n    // Create a popup, but don't add it to the map yet.\n    var hoverPop = new mapboxgl.Popup({\n      closeButton: false,\n      closeOnClick: false\n    });\n\n    // Change to a pointer\n    map.on('mousemove', 'results-lyr-fill', (e) => {\n      map.getCanvas().style.cursor = 'pointer';\n\n      // Hover popup with basic stats\n      var description = \n        \"According to the 2018 Census,<br/>\" +\n        \"<strong>\" + e.features[0].properties.hex_percent.toFixed(0) + \"%</strong> \" +\n        \"of homes in this area were<br/>\" +\n        \"reported as damp or mouldy.\";\n      \n      // Populate the popup and set its coordinates based on the feature found.\n      hoverPop\n        .setLngLat(e.lngLat)\n        .setHTML(description)\n        .addTo(map);\n    });\n    map.on('mouseenter', 'results-lyr', (e) => {\n      map.getCanvas().style.cursor = 'pointer';\n\n      // Hover popup with basic stats\n      var description = \n        \"According to the 2018 Census,<br/>\" +\n        \"<strong>\" + e.features[0].properties.hex_percent.toFixed(0) + \"%</strong> \" +\n        \"of homes in this area were<br/>\" +\n        \"reported as damp or mouldy.\";\n      \n      // Populate the popup and set its coordinates based on the feature found.\n      hoverPop\n        .setLngLat(e.lngLat)\n        .setHTML(description)\n        .addTo(map);\n    });\n    // Change it back to a pointer when it leaves.\n    map.on('mouseleave', 'results-lyr-fill', () => {\n      map.getCanvas().style.cursor = '';\n      hoverPop.remove();\n    });\n    map.on('mouseleave', 'results-lyr', () => {\n      map.getCanvas().style.cursor = '';\n      hoverPop.remove();\n    });\n    map.moveLayer('iso-lyr')\n    map.moveLayer('clinics-lyr')\n    this.activity(false);\n\n  }\n\n  addLyrListControls = () => {\n    const map = this.state.map;\n    // Handle layers within layer toggle control\n    var toggleableLayerIds = [\n      // Map cadastral layers\n      { id: 'clinics-lyr', label: 'GP / Health Clinics', legend: '<span class=\"dot-legend\" style=\"background-color: #fff\"></span>' },\n    ];\n    // Set up the corresponding toggle button for each layer\n    for (var i = 0; i < toggleableLayerIds.length; i++) {\n      var id = toggleableLayerIds[i]['id'];\n      var label = toggleableLayerIds[i]['label'];\n      var legendVal = toggleableLayerIds[i]['legend'];\n      var legend = legendVal ? legendVal : '';\n\n      var link = document.createElement('a');\n      var vis = map.getLayoutProperty(toggleableLayerIds[i]['id'], 'visibility');\n      link.href = '#';\n      link.className = (vis === 'none') ? '' : 'active';\n      link.innerHTML = label + legend;\n      link.id = id;\n\n      link.onclick = function (e) {\n        var clickedLayer = this.id;\n        e.preventDefault();\n        e.stopPropagation();\n        var visibility = map.getLayoutProperty(clickedLayer, 'visibility');\n\n        // Toggle layer visibility by changing the layout object's visibility property\n        if (visibility === 'none') { // Display it\n          map.setLayoutProperty(clickedLayer, 'visibility', 'visible');\n          this.className = 'active';\n        }\n        else { // Hide it\n          map.setLayoutProperty(clickedLayer, 'visibility', 'none');\n          this.className = '';\n        }\n      };\n      var layers = document.getElementById('menu');\n      layers.appendChild(link);\n    }\n\n  }\n\n  componentDidMount() {\n    mapboxgl.accessToken = 'pk.eyJ1Ijoib3JiaWNhIiwiYSI6ImNqcmxhazIwZzA2ajA0YW11cHc3OGM3M3AifQ.wTbR1Nh5HxJi8xLu0HLREQ';\n    // Set initial view state to Auckland\n    const vw = {\n      longitude: 174.763641,\n      latitude: -36.860944,\n      zoom: 10,\n      style: \n      'mapbox://styles/mapbox/light-v9'\n      // 'mapbox://styles/mapbox/dark-v9'\n    }\n\n    // Init Mapbox.gl map canvas\n    const map = new mapboxgl.Map({\n      container: 'map',\n      style: vw.style,\n      center: [vw.longitude, vw.latitude],\n      zoom: vw.zoom,\n    });\n    this.setState({\n      map: map\n    });\n\n    map.on('load', () => {\n      // Initialise layers with bbox\n      this.addLayers();\n    })\n\n    map.on('moveend', () => {\n      // Re fetch upon map move\n      this.updateLayers();\n    })\n\n    this.addCustomControls(map);\n  }\n\n  addCustomControls = (map) => {\n    var geocoder = new MapboxGeocoder({\n      accessToken: mapboxgl.accessToken,\n      mapboxgl: mapboxgl,\n      countries: 'nz',\n      placeholder: 'Find address or place'\n    });\n    var nav = new mapboxgl.NavigationControl();\n    var scale = new mapboxgl.ScaleControl({\n      maxWidth: 80,\n      unit: 'metric'\n    });\n    map.addControl(geocoder, 'top-left');\n    map.addControl(nav, 'top-left');\n    map.addControl(scale);\n  }\n\n  activity = (bool) => {\n    this.setState({activity: bool})\n  }\n\n  fly = (loc) => {\n    switch(loc) {\n      case 'akl':\n        this.state.map.flyTo({center: [174.763641,-36.860944], zoom: 10})\n        break;\n      case 'wgn':\n        this.state.map.flyTo({center: [174.778404,-41.287739], zoom: 11})\n        break;\n      case 'chc':\n        this.state.map.flyTo({center: [172.635405,-43.525003], zoom: 11})\n        break;\n      default:\n        break;\n    }\n  }\n\n  render() {\n    return (\n      <div id='container'>\n        <div id='map'>\n          {this.state.activity ? <Spinner variant=\"primary\" animation=\"border\" id=\"acty\" /> : null }\n          <div id=\"shortcuts\">\n            <Nav className=\"justify-content-center\">\n              <Nav.Item><Nav.Link href=\"#akl\" className='short' onClick={(e) => this.fly('akl')}>Auckland</Nav.Link></Nav.Item>\n              <Nav.Item><Nav.Link href=\"#wgn\" className='short' onClick={(e) => this.fly('wgn')}>Wellington</Nav.Link></Nav.Item>\n              <Nav.Item><Nav.Link href=\"#chc\" className='short' onClick={(e) => this.fly('chc')}>Christchurch</Nav.Link></Nav.Item>\n            </Nav>\n          </div>\n          <nav id='menu'>\n            <span id='menu-title'>Map Layers</span>\n          </nav>\n        </div>\n      </div>\n    );\n  }\n}\n\nexport default Map;","import React from 'react';\nimport { Navbar, Nav } from 'react-bootstrap';\n\nclass Header extends React.Component {\n  render() {\n\n    return (\n      <Navbar variant='light' bg='light' expand='lg' sticky='top'>\n        <Navbar.Toggle aria-controls='basic-navbar-nav' />\n       \n        <Navbar.Collapse id='basic-navbar-nav'>\n          <span className='header-text text-dark'>GP / Health Analysis Tool</span>\n          <Nav className='mr-auto'>\n            <Nav.Link href='#'>&nbsp;</Nav.Link>\n            <Nav.Link href='#'>A HERE Hackathon Project</Nav.Link>\n          </Nav>\n        </Navbar.Collapse>\n      </Navbar>\n    );\n  }\n}\n\nexport default Header;","import React from 'react';\n\nclass PanelLeft extends React.Component {\n  state = {\n    modal: false\n  }\n\n  // Return data to callback function in App.js\n  sendToParent = (d) => {\n    this.props.callback(d);\n  }\n\n  // Button to reset the view\n  resetView = () => {\n    window.location.reload(1);\n  }\n\n  // Display or hide a modal with full image\n  showModal = () => {\n    // console.log('you clicked the image')\n    this.setState({\n      modal: true\n    });\n  }\n  hideModal = () => {\n    this.setState({\n      modal: false\n    });\n  }\n\n  componentDidMount() {\n  }\n\n  // componentDidUpdate(prevProps, prevState) {\n  // }\n\n  render() {\n    \n    return (\n      <>\n        <div className=\"panel-text\">\n\n          <div className=\"card mb-3\">\n            <div className=\"card-body\">\n              <h5 className=\"card-title\">GP Clinic Locations</h5>\n              <h6 className=\"card-subtitle text-muted\">Health Risk Analysis Tool</h6>\n            </div>\n            <img src=\"./assets/ani-kolleshi-7jjnJ-QA9fY-unsplash.jpg\" alt=\"\" className=\"img-responsive\" id=\"play\"></img>\n            <div className=\"card-body\">\n              <p className=\"card-text\">This tool aims to assist health clinic officials in New Zealand. It helps to identify the most at risk patient locations in relation to a clinic.</p>\n              <p className=\"card-text\">Click on a health clinic to begin - this will generate a clinic service area and symbolise the most at risk areas. This information is calculated from damp and mouldy housing statistics (2018 New Zealand Census).</p>\n              <hr style={{width:'50%'}}/>\n              <p className=\"card-text\">Built with HERE, HERE APIs, Stats NZ data, React, Bootstrap, and Carto Colours.</p>\n              <a href=\"https://github.com/nzjs\" rel=\"noreferrer\" target=\"_blank\" className=\"card-link\">Developed by John Stowell</a>\n            </div>\n            <div className=\"card-footer text-muted\"></div>\n          </div>\n\n          <div className=\"card\">\n              <div className=\"card-body\">\n                <h5 className=\"card-title\">Map Legend</h5>\n                <div className=\"legend\">\n                  <span className=\"legend-title\">Health Risk (Damp Housing)</span>\n                  <span className=\"left fff\">Less</span>\n                  <span className=\"right fff\">More</span>\n                </div>\n              </div>\n            <div className=\"card-footer text-muted\"></div>\n          </div>\n\n        </div>\n      </>\n    )\n  }\n}\n\nexport default PanelLeft;","import React from 'react';\nimport './App.css';\nimport { Container, Row, Col } from 'react-bootstrap';\nimport Map from './components/Map';\nimport Header from './components/Header';\nimport PanelLeft from './components/Panel';\n\nclass App extends React.Component {\n  state = {\n    selection: null,\n    isLoading: true\n  }\n\n  callbackSelection = (selection) => {\n    this.setState({\n      selection: selection\n    })\n  }\n\n  render() {\n    return (\n      <>\n        <Header />\n        <Container fluid>\n          <Row>\n            <Col xs={12} md={3} className='panel'>\n              <PanelLeft />\n            </Col>\n            <Col xs={12} md={9} className='panel-mapbox'>\n              <Map callback={this.callbackSelection}/>\n            </Col>\n          </Row>\n        </Container>\n      </>\n    );\n  }\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n","const HERE = '8A2g5AjfRMpTn59J9SB0m_AWBgO6B0lzzGtNsArwCt4';\nconst H_DATA_ID = 'pO2YTR8X'\nconst H_DATA = 'AKkxwrw0T9KZYZQ2NmVRigA'\nconst LINZ = '07c372d6ebee4ab393bfc9b47ead5e63';\n\nmodule.exports = {\n    HERE,\n    H_DATA_ID,\n    H_DATA,\n    LINZ\n}"],"sourceRoot":""}